$(document).ready(function() {
	 var cGSAhost = document.location.hostname;
	 var envGSAPrefix = "";
     var envGSAHost = "http://agathon.corp.toronto.ca/suggest";
 
	 if( (cGSAhost.indexOf("urania-a5") > -1) ||  (cGSAhost.indexOf("urania-a5") > -1) ) { 
		envGSAPrefix = "SBX";
	 } else if( (cGSAhost.indexOf("urania-a3") > -1) ||  (cGSAhost.indexOf("urania-a2") > -1) ) { 
		envGSAPrefix = "SIT";
 	 } else if(cGSAhost.indexOf("qaportal-delivery-lbvip") > -1) { 
		envGSAPrefix = "QA";
	 } else if(cGSAhost.indexOf("stgportal-delivery-lbvip") > -1) { 
		envGSAPrefix = "STAGE";
	 } else if( (cGSAhost.indexOf("homer-4") > -1) ) { 
		envGSAPrefix = "TRAIN";
	 } else {
        envGSAHost = "http://search.toronto.ca/suggest";
     }

     $( "#q" ).autocomplete({
      source: function( request, response ) {
        $.ajax({
          url: envGSAHost,
          dataType: "jsonp",
          data: {
            token: request.term,
            client: envGSAPrefix + "Toronto",
            site:  envGSAPrefix + "TorontoWebsite",
            format: "legacy"
          },
          success: function( data ) {
            dataClean = processTypeAheadData(data);
            response( dataClean );
          }
        });
      },
      select: function(event, ui) {
          $('#q').val(ui.item.value);
		  $('#siteSearchGSA').submit();
	  },
      minLength: 1
    });
});

function processTypeAheadData(typeAheadArray) {
   var resultArray = new Array();
   for(var i=0; i<typeAheadArray.length; i++) {
      var tmpEntry = typeAheadArray[i];
      resultArray[i] = tmpEntry;
   }
   return resultArray;
}