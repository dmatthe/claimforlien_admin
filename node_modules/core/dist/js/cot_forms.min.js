"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,i=new Array(e.length);t<e.length;t++)i[t]=e[t];return i}}function CotForm(e){function t(e,i,a){$.each(e||[],function(e,n){var r=i.addSection({id:n.id||"section"+a+e,title:n.title,className:n.className,readSectionName:n.readSectionName,type:n.type,allowMultiple:n.allowMultiple,expanded:n.expanded,headingLevel:n.headingLevel});n.sections&&t(n.sections,r,a+e+"_"),$.each(n.rows||[],function(e,t){t.fields?(t.fields.forEach(function(e){var t=e.type||"text";if(e.bindTo&&-1===o.indexOf(t))throw new Error("Error in field "+(e.id||"no id")+", fields of type "+t+" cannot use bindTo.")}),r.addRow(t.fields)):t.grid?r.addGrid(t.grid):t.repeatControl&&r.addRepeatControl(t.repeatControl)})})}if(!e)throw new Error("You must supply a form definition");this._isRendered=!1,this._definition=e,this._useBinding=e.useBinding||!1,this._model=null,this.cotForm=new cot_form({id:e.id||"new_form",title:e.title,rootPath:e.rootPath,success:e.success||function(){}}),this.cotForm._cotForm=this;var i=this,o=["text","number","phone","email","hidden","dropdown","textarea","checkbox","radio","password","multiselect","datetimepicker","daterangepicker","dropzone"];t(e.sections,i.cotForm,"")}var cotform_ui=new COTUI,IEversion=navigator.userAgent.indexOf("MSIE")>1?parseInt(navigator.userAgent.substr(navigator.userAgent.indexOf("MSIE")+5,5)):99,cot_form=function(e){this.id=e.id,this.title=e.title,this.success=e.success,this.rootPath=e.rootPath,this.sections=[]};cot_form.addDefaultFieldProperties=function(e){return cot_form.fixClassProperty(e),(e||[]).forEach(function(e){if(e.type=e.type||"text",e.id=e.id||Math.random().toString().split(".")[1],-1!=="html button static".indexOf(e.type)||e.title||console.warn("Missing title attribute for field "+e.id),["radio","checkbox","dropdown","multiselect"].indexOf(e.type)>-1&&!$.isArray(e.choices))throw new Error("Error in field "+e.id+": choices property is missing or invalid");"datetimepicker"===e.type&&(e.options=$.extend({format:"MM/DD/YYYY"},e.options)),"daterangepicker"===e.type&&(e.options=$.extend({locale:{format:"MM/DD/YYYY",separator:" - "}},e.options))}),e},cot_form.fixClassProperty=function(e){$.each($.makeArray(e||[]),function(e,t){void 0===t.className&&"string"==typeof t.class&&(t.className=t.class,delete t.class)})};var cot_section=function(e){cot_form.fixClassProperty(e),this.id=e.id,this.title=e.title,this.className=e.className,this.readSectionName=e.readSectionName,this.rows=[],this.type=e.type||"panel",this.allowMultiple=e.allowMultiple,this.sections=[],this.expanded=e.expanded,this.headingLevel=e.headingLevel},cot_row=function(e){this.fields=cot_form.addDefaultFieldProperties(e),this.type="standard"},cot_grid=function(e){cot_form.fixClassProperty(e),this.id=e.id?e.id:"grid-"+Math.floor(1e8*Math.random()),this.add=!!e.add,this.className=e.className,this.title=e.title,this.headers=e.headers,this.fields=cot_form.addDefaultFieldProperties(e.fields),this.type="grid"};cot_form.prototype.addSection=function(e){return e instanceof cot_section||(e=new cot_section(e)),this.sections.push(e),e},cot_section.prototype.addSection=function(e){return e instanceof cot_section||(e=new cot_section(e)),this.sections.push(e),e},cot_section.prototype.addRow=function(e){return e instanceof cot_row||(e=new cot_row(e)),this.rows.push(e),this},cot_section.prototype.addGrid=function(e){return e instanceof cot_grid||(e=new cot_grid(e)),this.rows.push(e),this};var cot_repeatControl=function(e){cot_form.fixClassProperty(e);for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);if(this.id||(this.id="repeatControl-"+Math.floor(1e7*Math.random())),null==this.min&&(this.min=0),(null==this.max||this.max<this.min)&&(this.max=-1),(null==this.initial||this.initial<this.min||-1!=this.max&&this.initial>this.max)&&(-1!=this.max&&this.initial>this.max?this.initial=this.max:this.initial=this.min),this.rows)for(var i=this.rows.length,o=0;o<i;o++)if(this.rows[o].fields)this.rows[o].fields=cot_form.addDefaultFieldProperties(this.rows[o].fields);else if(this.rows[o].grid){new cot_grid(this.rows[o].grid)}this.type="repeatcontrol"};cot_section.prototype.addRepeatControl=function(e){return e instanceof cot_repeatControl||(e=new cot_repeatControl(e)),this.rows.push(e),this},cot_form.prototype.render=function(e){var t=this,i={fields:{}},o=document.createElement("form");if(o.id=this.id,o.className="cot-form",o.setAttribute("data-fv-framework","bootstrap"),o.setAttribute("data-fv-icon-valid","glyphicon glyphicon-ok"),o.setAttribute("data-fv-icon-invalid","glyphicon glyphicon-remove"),o.setAttribute("data-fv-icon-validating","glyphicon glyphicon-refresh"),this.title){o.appendChild(document.createElement("h2")).textContent=this.title}$.each(this.sections,function(e,a){if("accordion"===a.type){if("string"!=typeof this.title)throw new Error("Accordion title required.");var n=document.getElementById("js-cotui-accordion-template");n||(n=document.createElement("template"),n.setAttribute("id","js-cotui-accordion-template"),n.innerHTML=['<div class="panel panel-default accordion__section">','<div class="panel-heading accordion__header">','<button class="btn accordion__button" data-type="toggle" aria-controls="{{ID}}" aria-expanded="false"></button>',"</div>",'<div id="{{ID}}">',"{{BODY}}","</div>","</div>"].join(""),document.body.appendChild(n));var r={title:this.title,target:o,template:n,allowMultiple:"boolean"!=typeof a.allowMultiple||a.allowMultiple,expandButtonClass:"accordion__button--expand btn btn-link",collapseButtonClass:"accordion__button--collapse btn btn-link",sections:[],level:"number"==typeof a.headingLevel?a.headingLevel:3,attrs:[]};"string"==typeof a.id&&r.attrs.push({id:a.id}),"string"==typeof a.className&&r.attrs.push({class:a.className});for(var d={fields:{}},l=0,s=a.sections.length;l<s;l++)!function(){var e=document.createElement("div");e.classList.add("panel-body"),$.each(a.sections[l].rows,function(i,o){var a=e.appendChild(document.createElement("div"));a.className="row","repeatcontrol"==o.type?t.processRepeatControl(a,d,o):"grid"==o.type?t.processGrid(a,d,o):$.each(o.fields,function(e,i){t.processField(a,d,o,i)})});var i=void 0;"boolean"==typeof a.sections[l].expanded&&(i=a.sections[l].expanded),"boolean"!=typeof a.sections[l].expanded&&(i=0===l);var o={title:a.sections[l].title,body:e,expanded:i};"string"==typeof a.sections[l].id&&(o.id=a.sections[l].id),r.sections.push(o)}();for(var c in d.fields)"boolean"!=typeof d.fields[c].excluded&&(d.fields[c].excluded=!1),i.fields[c]=d.fields[c];cotform_ui.Accordion(r)}else{var p=o.appendChild(document.createElement("div"));if(p.id=a.id,p.className=void 0!==a.className?"panel "+a.className:"panel panel-default",a.title){var m=p.appendChild(document.createElement("div"));m.className="panel-heading";var u=m.appendChild(document.createElement("h3"));u.appendChild(document.createElement("span")).className="glyphicon glyphicon-th-large",u.appendChild(document.createElement("span")),u.textContent=a.title,a.readSectionName&&(u.id=a.id+"_title")}var f=p.appendChild(document.createElement("div"));f.className="panel-body",$.each(a.rows,function(e,o){var a=f.appendChild(document.createElement("div"));a.className="row","repeatcontrol"==o.type?t.processRepeatControl(a,i,o):"grid"==o.type?t.processGrid(a,i,o):$.each(o.fields,function(e,n){t.processField(a,i,o,n)})})}}),$(e.target).append(o),$.each(this.sections,function(e,i){$.each(i.rows,function(e,i){t.initializePluginsInRow(i)})});var a=$("#"+this.id),n=$.extend({excluded:[":not(.multiselect):disabled",":not(.multiselect):hidden",":not(.multiselect):not(:visible)"],feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},onSuccess:this.success,onError:function(e){window.console&&console.error&&console.error("Validation error occurred:",e),$(".has-error input, .has-error select, .has-error button, .has-error textarea").closest('[is="cotui-accordion"]').each(function(e,t){var i=$(t),o=i.find(".has-error input, .has-error select, .has-error button, .has-error textarea"),a=o.closest(".accordion__section");0===i.find(".accordion__button--expand").length&&(a=a.first()),a.find('[data-hidden="true"]').each(function(e,i){t.expandSectionById&&t.expandSectionById(i.getAttribute("id"),!0)})});var t=$($(".has-error input, .has-error select, .has-error button, .has-error textarea")[0]);if(t.focus(),t[0].getBoundingClientRect){var i=t[0].getBoundingClientRect();(i.top<0||i.top>$(window).height()-50)&&$("html,body").animate({scrollTop:Math.max(0,t.offset().top-100)},"slow")}},fields:i.fields},e.formValidationSettings||{});a.formValidation(n).on("err.field.fv",function(e){$(e.target).closest(".form-group").find("input,select,textarea").attr("aria-invalid",!0)}).on("success.field.fv",function(e,t){$(e.target).closest(".form-group").find("input,select,textarea").attr("aria-invalid",!1)}).on("err.form.fv",function(e){var t=$(".has-error",a).first(),i=t.find("input");i&&"hidden"===i.prop("type")&&t.find("button").first().focus()}),a.find("button.fv-hidden-submit").text("hidden submit button"),a.find("button.fv-hidden-submit").attr("aria-hidden",!0),t.fixFormValidationRender(a)},cot_form.prototype.fixFormValidationRender=function(e){e.find("i.form-control-feedback").attr("aria-hidden","true"),e.find("label.radioLabel>i, label.checkboxLabel>i").each(function(){var e=$(this);e.insertAfter(e.closest("fieldset").find("legend"))}),e.find("div.datetimepicker").each(function(){var e=$(this);e.parent().find("i.form-control-feedback").insertAfter(e.find("input"))})},cot_form.prototype.initializePluginsInRow=function(e,t){t||(t=$("#"+this.id));var i=this;$.each(e.fields,function(e,o){switch(o.type){case"multiselect":var a=t.find("."+o.id+".multiselect");(window.cot_app||window.CotApp).addMultiselect({$select:a,ariaLabelledBy:a.attr("aria-labelledby"),ariaDescribedBy:a.attr("aria-describedby"),ariaRequired:a.attr("aria-required"),multiselectOptions:o.options});break;case"daterangepicker":t.find(".daterangevalidation").daterangepicker(o.options).on("show.daterangepicker",function(e,t){$($(t)[0]).focus()}),$(".daterangepicker").attr("aria-hidden",!0);break;case"datetimepicker":t.find("."+o.id+".datetimepicker").datetimepicker(o.options).on("dp.change",function(){var e=$(this).attr("data-refid");$("#"+i.id).data("formValidation").updateStatus(e,"NOT_VALIDATED").validateField(e)});break;default:if("Phone"===o.validationtype&&IEversion>=10){if("string"!=typeof i.rootPath)throw new Error("rootPath must be defined for cot form when using Phone fields");t.find("#"+o.id+'.phonevalidation, [name$=".'+o.id+'"].phonevalidation').each(function(e,t){var a=$(t);-1===a.attr("name").indexOf("[template]")&&(a.attr("type","tel"),a.intlTelInput($.extend({autoPlaceholder:!1,allowDropdown:!1,preferredCountries:["ca"],utilsScript:i.rootPath+"js/utils.js"},o.options||{})),a.on("country-change",function(){var e=$(this).attr("name");$("#"+i.id).data("formValidation").updateStatus(e,"NOT_VALIDATED").validateField(e)}),$("#"+o.id).insertBefore($("#"+o.id).prev()),setTimeout(function(){$("#"+o.id).parent().find(".flag-container").insertBefore($("#"+o.id).parent().find(".flag-container").prev())},300))}),t.find(".flag-dropdown").attr("aria-hidden",!0)}}}),t.find('[data-toggle="tooltip"]').tooltip({html:!0})},cot_form.prototype.processRepeatControl=function(e,t,i){this.repeatControlIndex=this.repeatControlIndex||{},this.repeatControlIndex[i.id]=0;var o=$(['<div class="repeatControl">','<div class="repeatControl-wrapper">','<div class="repeatControl-title"></div>','<div class="repeatControl-set repeatControl-template">','<div class="repeatControl-set-title"></div>','<div class="repeatControl-set-rows"></div>','<p class="repeatControl-set-button">','<button class="btn" type="button">','<span class="glyphicon"></span><span class="repeatControl-set-button-label"></span>',"</button>","</p>","</div>",'<div class="repeatControl-sets"></div>','<p class="repeatControl-button">','<button class="btn" type="button">','<span class="glyphicon"></span><span class="repeatControl-button-label"></span>',"</button>","</p>","</div>","</div>"].join(""));o.attr("id",i.id),o.addClass(i.className||"col-xs-12"),$(e).append(o),i.title&&$(".repeatControl-title",o).append($("<h4>").text(i.title)),$(".repeatControl-template",o).addClass(i.setClassName||""),i.setTitle&&$(".repeatControl-set-title",o).append($("<h5>").text(i.setTitle));for(var a={},n=[],r=i.rows||[],d=r.length,l=0;l<d;l++){var s=$('<div class="row">');if($(".repeatControl-set-rows",o).append(s),r[l].fields)for(var c=r[l].fields||[],p=c.length,m=0;m<p;m++){var u=$.extend({},c[m],{id:i.id+"___idx___"+c[m].id});a[u.id]=u,n.push(u),this.processField(s[0],t,r[l],u)}else if(r[l].grid){r[l].grid.id=[i.id,"___idx___",r[l].grid.id].join("");for(var c=r[l].grid.fields||[],p=c.length,m=0;m<p;m++)$.extend(r[l].grid.fields[m],{id:[i.id,"___idx___",r[l].grid.fields[m].id].join(""),type:r[l].grid.fields[m].type||"text"});s.attr("data-grid",r[l].grid.id)}else r[l].repeatcontrol}$(".repeatControl-set-button",o).addClass(i.removeClassName||""),$(".repeatControl-set-button .btn",o).addClass(i.removeBtnClassName||"btn-default"),$(".repeatControl-set-button .glyphicon",o).addClass(i.removeBtnGlyphicon||"glyphicon-minus"),$(".repeatControl-set-button-label",o).text(i.removeBtnLabel||"Remove row"+(i.title?" to "+i.title:"")),$(".repeatControl-button",o).addClass(i.addClassName||""),$(".repeatControl-button .btn",o).addClass(i.addBtnClassName||"btn-default"),$(".repeatControl-button .glyphicon",o).addClass(i.addBtnGlyphicon||"glyphicon-plus"),$(".repeatControl-button-label",o).text(i.addBtnLabel||" Add row"+(i.title?" to "+i.title:""));var f=this;o[0].removeRows=function(){f.repeatControlIndex[i.id]=0,o[0].resetMode=!0,$(".repeatControl-sets .repeatControl-set-button .btn",o).trigger("click"),o[0].resetMode=!1;for(var e=0;e<i.initial;e++)o[0].addRow()},o[0].addRow=function(){var e=f.repeatControlIndex[i.id];if(-1==i.max||$(".repeatControl-sets .repeatControl-set-button .btn",o).length<i.max){var r=$(".repeatControl-template",o),d=r.clone().removeClass("repeatControl-template"),l=d.html();l=l.replace(new RegExp("___idx___","g"),"_"+f.repeatControlIndex[i.id]+"_"),d.html(l),$(".repeatControl-sets",o).append(d);for(var s=i.rows,c=s.length,p=0;p<c;p++)if(s[p].grid){var m=$.extend({},s[p].grid,{id:s[p].grid.id.replace("___idx___","_"+f.repeatControlIndex[i.id]+"_")}),u=m.fields,h=u.length;m.fields=[];for(var v=0;v<h;v++)u[v].id&&m.fields.push($.extend({},u[v],{id:u[v].id.replace("___idx___","_"+f.repeatControlIndex[i.id]+"_")}));var g=$('[data-grid="'+m.id+'"]',d);f.processGrid(g[0],t,m);for(var b=m.fields,_=b.length,y=0;y<_;y++){var C=$('[name="row[0].'+b[y].id+'"]');$("#"+f.id).formValidation("addField",C,t.fields["row[0]."+b[y].id]),i.bindTo&&f._cotForm._setupField(C,b[y],i.bindTo+"["+e+"]."+m.bindTo+"[0]")}f.initializePluginsInRow(m,d),f.fixFormValidationRender(d);var x=$("#"+m.id+" button.grid-add",g).get(0);x.onclick=function(t,o){return function(a){t(a);var n=f,r=$("#"+o.id+" [data-row-index]:last");if($("button.grid-minus",r).off("click").on("click",function(e){var t=$("#"+o.id+" [data-row-index]"),i=$(this).closest("[data-row-index]"),a=t.index(i);if(n._cotForm&&n._cotForm._model&&n._cotForm._model.get(o.bindTo)){var r=n._cotForm._model.get(o.bindTo);r&&r.models&&r.remove(r.models[a])}var d=$(this).closest("tr");$.each(d.find(".form-control"),function(e,t){var i=$(t),o="FIELDSET"===t.tagName.toUpperCase()?i.find("input").first().attr("name"):i.attr("name");$("#"+n.id).formValidation("removeField",o)});var l=d.prev().find("input,select,textarea").first();d.remove(),l.focus()}),n._cotForm&&n._cotForm._model&&n._cotForm._model.get(o.bindTo)){var d=n._cotForm._model.get(o.bindTo);d&&d.push(new CotModel)}var l=+r.attr("data-row-index"),s="row["+l+"].";(o.fields||[]).forEach(function(t){n._cotForm._setupField($('[name="'+s+t.id+'"]'),t,i.bindTo+"["+e+"]."+o.bindTo+"["+l+"]")})}}(x.onclick,m)}$(".repeatControl-set-button .btn",d).click(function(e){if(1==o[0].resetMode||$(".repeatControl-sets .repeatControl-set-button .btn",o).length>i.min){for(var t in a)$("#"+f.id).formValidation("removeField",$('[name="'+t+'"]',d));if(i.bindTo&&f._cotForm._model&&f._cotForm._model.get(i.bindTo)){var n=$(".repeatControl-sets .repeatControl-set",o).index(d),r=f._cotForm._model.get(i.bindTo);r.remove(r.at(n))}d.remove(),i.removeBtnOnClick&&i.removeBtnOnClick(e)}});var w=$(".repeatControl-sets .repeatControl-set",o).index(d);if(i.bindTo&&f._cotForm._model){f._cotForm._model.get(i.bindTo)||f._cotForm._model.set(i.bindTo,new CotCollection);f._cotForm._model.get(i.bindTo).push(new CotModel({}))}for(var F in a){var E=F.replace("___idx___","_"+f.repeatControlIndex[i.id]+"_"),k="fv_err_msg_"+E,C=$('[name="'+E+'"]',d),N=C.closest(".entryField").nextAll(".fv-err-msg");N.attr("id",k),N.empty(),a[F].id=E,C.attr("aria-describedby",k);var T=f.validatorOptions(a[F]);T.err="#"+k,$("#"+f.id).length>0?$("#"+f.id).formValidation("addField",C.attr("name"),T):t.fields[E]=T,i.bindTo&&f._cotForm._setupField(C,a[F],i.bindTo+"["+w+"]")}f.initializePluginsInRow({fields:n},d),f.fixFormValidationRender(d),d.find("input, select, textarea").first().focus(),f.repeatControlIndex[i.id]=f.repeatControlIndex[i.id]+1}},o[0].setCotForm=function(e){this.cotForm=e},$(".repeatControl-button .btn",o).click(function(e){o[0].addRow(),i.addBtnOnClick&&i.addBtnOnClick(e)}),o[0].removeRows()},cot_form.prototype.processGrid=function(e,t,i){var o,a=this,n=e.appendChild(document.createElement("div"));n.id=i.id,n.className="grid-object table-responsive ",n.className+=i.className||"",n.className+=i.addclass?" "+i.addclass:"",a[n.id+"-index"]=0;var r=n.appendChild(document.createElement("h4"));r.className="grid-title",r.textContent=i.title;var d=n.appendChild(document.createElement("table"));d.className="grid-table table table-striped";var l=d.appendChild(document.createElement("caption"));l.className="sr-only",l.textContent=i.title;var s=d.appendChild(document.createElement("tr"));$.each(i.headers,function(e,t){var o=s.appendChild(document.createElement("th"));o.textContent=t.title,o.id=i.id+"_header_"+e,$(o).attr("scope","col")}),oTH=s.appendChild(document.createElement("th")),$(oTH).attr("scope","col");var c=oTH.appendChild(document.createElement("span"));c.className="sr-only",c.textContent="Add/Remove Entries",s=d.appendChild(document.createElement("tr")),s.id=i.id+"-row-0",s.setAttribute("data-row-index","0");var p={};$.each(i.fields,function(e,o){var r=s.appendChild(document.createElement("td"));if(r.className="form-group",r.className+=o.addclass?" "+o.addclass:"",o.grid="0",o.gridlabel=i.id+"_header_"+e,0===e){var d=r.appendChild(document.createElement("span"));d.className="sr-only",d.id=n.id+"_row_sr_label_0",d.textContent=i.title+" entry 1"}a.addformfield(o,r);var l=o.id;o.id="row[0]."+o.id,a.addfieldvalidation(t,o,r),o.id=l,p[o.id]=o});var m=s.appendChild(document.createElement("td"));m.className="text-right",o=m.appendChild(document.createElement("button")),o.className="btn btn-default grid-minus",o.type="button",o.disabled=!0,o.title="Remove entry 1 from "+i.title,o.appendChild(document.createElement("span")).className="glyphicon glyphicon-minus";var c=o.appendChild(document.createElement("span"));c.className="sr-only",c.textContent="Remove entry 1",s=d.appendChild(document.createElement("tr")),s.id=n.id+"-template",s.className="hide",$.each(i.fields,function(e,t){var o=s.appendChild(document.createElement("td"));if(o.className="form-group",o.className+=t.addclass?" "+t.addclass:"",t.grid="template",0===e){var r=o.appendChild(document.createElement("span"));r.className="sr-only",r.id=n.id+"_row_sr_label_template",r.textContent=i.title+", row template"}a.addformfield(t,o)}),m=s.appendChild(document.createElement("td")),m.className="text-right",o=m.appendChild(document.createElement("button")),o.type="button",o.className="btn btn-default grid-minus",o.title="Remove entry displayRowNumber from "+i.title,c=o.appendChild(document.createElement("span")),c.className="glyphicon glyphicon-minus",c=c.appendChild(document.createElement("span")),c.className="sr-only",c.textContent="Remove entry displayRowNumber",s=d.appendChild(document.createElement("tr")),m=s.appendChild(document.createElement("td")),m.colSpan=i.fields.length+1,o=m.appendChild(document.createElement("button")),o.className="btn btn-default pull-right grid-add",o.type="button",o.onclick=function(){a[n.id+"-index"]++;var e=a[n.id+"-index"],t=$("#"+n.id+"-template"),o=t.clone().removeClass("hide").attr("id",n.id+"-row-"+e).attr("data-row-index",e),r=o.html();r=r.replace(/, row template/g,", entry "+(parseInt(e)+1)),r=r.replace(/displayRowNumber/g,parseInt(e)+1),r=r.replace(/template/g,e),o.html(r),o.insertBefore(t),o.find(".grid-minus").click(function(){var e=$(this).closest("tr");$.each(e.find(".form-control"),function(e,t){var i=$(t),o="FIELDSET"===t.tagName.toUpperCase()?i.find("input").first().attr("name"):i.attr("name");$("#"+a.id).formValidation("removeField",o)});var t=e.prev().find("input,select,textarea").first();e.remove(),t.focus()});var d=o.find(".form-control");$.each(d,function(t,i){var o=$(i),n="FIELDSET"===i.tagName.toUpperCase()?o.find("input").first().attr("name"):o.attr("name"),r=p[n.split(".")[1]],d=a.validatorOptions(r);a.addValidatorMessageDiv(r,d,o.closest("td")[0],e),$("#"+a.id).formValidation("addField",n,d)}),a.initializePluginsInRow(i,o),a.fixFormValidationRender(o),o.find("input,select,textarea").first().focus()},o.appendChild(document.createElement("span")).className="glyphicon glyphicon-plus";var c=o.appendChild(document.createElement("span"));c.textContent=" Add Row to "+i.title},cot_form.prototype.processField=function(e,t,i,o){var a=i.fields.length,n=e.appendChild(document.createElement("div"));n.id=o.id+"Element",n.className=o.className||(1==a?"col-xs-12":2==a?"col-xs-12 col-sm-6":3==a?"col-xs-12 col-md-4":"col-xs-12 col-sm-6 col-md-3"),n.className+=" form-group form-group-",n.className+=o.orientation||"vertical",n.className+=o.addclass?" "+o.addclass:"";var r=n.appendChild(document.createElement("div"));if(-1==["html","button"].indexOf(o.type)){var d=-1===["static","checkbox","radio"].indexOf(o.type);if(d||o.title){var l=r.appendChild(document.createElement(d?"label":"span"));l.className=d?"control-label":"staticlabel"+("static"!=o.type?" "+o.type:""),d&&(l.htmlFor=o.id);var s=l.appendChild(document.createElement("span"));if(s.textContent=o.title,"multiselect"===o.type&&($(l).attr("id",o.id+"_label"),$(s).append($('<span class="sr-only">:</span>'))),!o.required&&"static"!=o.type){var c=l.appendChild(document.createElement("span"));c.className="optional",c.textContent="(optional)"}if(o.infohelp){var p=l.appendChild(document.createElement("span"));p.className="glyphicon glyphicon-info-sign",p.setAttribute("data-toggle","tooltip"),p.setAttribute("data-placement","top"),p.tabIndex=0,p.title=o.infohelp}}}this.addprehelptext(o,r),this.addformfield(o,r),this.addposthelptext(o,r),this.addfieldvalidation(t,o,r)},cot_form.prototype.addprehelptext=function(e,t){if(e.prehelptext){var i=t.appendChild(document.createElement("p"));i.className="helptext",i.id="prehelptext_"+e.id,i.innerHTML=e.prehelptext}},cot_form.prototype.addformfield=function(e,t){t.appendChild(this.callFunction(this[e.type+"FieldRender"],e,t)),e.prehelptext&&this.updateDescribedBy(t,"prehelptext_"+e.id)},cot_form.prototype.addposthelptext=function(e,t){if(e.posthelptext){var i=t.appendChild(document.createElement("p"));i.className="helptext",i.id="posthelptext_"+e.id,i.innerHTML=e.posthelptext,this.updateDescribedBy(t,i.id)}},cot_form.prototype.validatorOptions=function(e){var t={};if("phone"===e.type?e.validationtype="Phone":"email"===e.type&&(e.validationtype="Email"),e.required&&(t.notEmpty={message:e.requiredMessage||e.title+" is required and cannot be left blank"}),"datetimepicker"===e.type)t.callback={message:e.validationMessage||"The date must be in the format "+e.options.format,callback:function(t){return""===t&&!e.required||moment(t,e.options.format,!0).isValid()}};else if("daterangepicker"===e.type)t.callback={message:e.validationMessage||"The dates must be in the format "+e.options.locale.format+e.options.locale.separator+e.options.locale.format,callback:function(t){var i=t.split(e.options.locale.separator);return""===t&&!e.required||2===i.length&&moment(i[0],e.options.locale.format,!0).isValid()&&moment(i[1],e.options.locale.format,!0).isValid()}};else switch(e.validationtype){case"Phone":t.callback={message:e.validationMessage||"This field must be a valid phone number.",callback:function(t,i,o){return IEversion<10?!e.required&&""===t||!(!t.match(/\d{3}-?\d{3}-?\d{4}/)||t.match(/\d{3}-?\d{3}-?\d{4}/)[0]!=t)&&(o.val(t.replace(/(\d{3})\-?(\d{3})\-?(\d{4})/,"$1-$2-$3")),!0):""===t||o.intlTelInput("isValidNumber")}};break;case"Email":t.emailAddress={message:e.validationMessage||"The value is not a valid email address"};break;case"URL":t.uri={message:e.validationMessage||"The value is not a valid URL (http://xx.xx or https://xx.xx)."};break;case"PostalCode":t.regexp={regexp:/^(?!.*[DFIOQU])[A-VXY][0-9][A-Z] ?[0-9][A-Z][0-9]$/i,message:e.validationMessage||"This field must be a valid postal code"}}var i={validators:$.extend(t,e.validators||{})};return"dropzone"==e.type&&(i.excluded=!1),i},cot_form.prototype.addfieldvalidation=function(e,t,i){var o=this.validatorOptions(t);this.addValidatorMessageDiv(t,o,i,t.grid),e.fields[t.id]=o},cot_form.prototype.addValidatorMessageDiv=function(e,t,i,o){if(!$.isEmptyObject(t.validators)){var a=i.appendChild(document.createElement("div"));a.id="fv_err_msg_"+Math.random().toString().split(".")[1]+"_"+(o||""),a.className="fv-err-msg",this.updateDescribedBy(i,a.id),t.err="#"+a.id}},cot_form.prototype.updateDescribedBy=function(e,t){var i=$(e).find("input,textarea,select"),o=i.attr("aria-describedby")?i.attr("aria-describedby").split(" "):[];i.attr("aria-describedby",o.concat([t]).join(" "))},cot_form.prototype.callFunction=function(e){return e.apply(this,Array.prototype.slice.call(arguments,1))},cot_form.prototype.staticFieldRender=function(e,t){var i=document.createElement("p");return i.name=e.grid?"row[0]."+e.id:e.id,i.textContent=e.value,i},cot_form.prototype.htmlFieldRender=function(e,t){var i=document.createElement("div");return i.name=e.grid?"row[0]."+e.id:e.id,i.innerHTML=e.html,i},cot_form.prototype.textFieldRender=function(e,t,i){var o=t.appendChild(document.createElement("div"));o.className="entryField";var a=o.appendChild(document.createElement("input"));if(e.htmlAttr&&$(a).attr(e.htmlAttr),a.title=e.title,a.type=i||"text",a.value=e.value?e.value:"",a.disabled=!!e.disabled&&"disabled",e.grid){var n=$(a).closest(".grid-object").attr("id");a.name="row["+e.grid+"]."+e.id,$(a).attr("aria-labelledby",n+"_row_sr_label_"+e.grid+" "+e.gridlabel)}else{a.name=e.id,a.id=e.id;var r=$(a).closest(".panel-info").find("h3").attr("id");r&&a.setAttribute("aria-labelledby",r+" "+e.id)}return e.required?(a.setAttribute("aria-required","true"),a.className="form-control required"):a.className="form-control","Phone"!=e.validationtype&&"tel"!=i||(a.className+=" phonevalidation "),a.placeholder=e.placeholder?e.placeholder:"",o},cot_form.prototype.passwordFieldRender=function(e,t){return this.textFieldRender(e,t,"password")},cot_form.prototype.numberFieldRender=function(e,t){return this.textFieldRender(e,t,"number")},cot_form.prototype.emailFieldRender=function(e,t){return this.textFieldRender(e,t,"email")},cot_form.prototype.phoneFieldRender=function(e,t){return this.textFieldRender(e,t,"tel")},cot_form.prototype.hiddenFieldRender=function(e,t,i){var o=t.appendChild(document.createElement("input"));return o.type=i||"hidden",o.value=e.val?e.val:"",o.name=e.id,o},cot_form.prototype.radioFieldRender=function(e){var t=document.createElement("fieldset");t.className="form-control";var i=t.appendChild(document.createElement("legend"));return i.className="sr-only",i.textContent="Select an option for "+(e.title||e.id),$.each(e.choices,function(i,o){var a=t.appendChild(document.createElement("label"));a.className=e.orientation?e.orientation:"vertical",a.className+=" entryField radioLabel";var n=a.appendChild(document.createElement("input"));e.grid?n.name="row["+e.grid+"]."+e.id:(n.name=e.id,n.id=e.id+"_"+i),e.required&&n.setAttribute("aria-required","true"),n.type="radio",n.className=e.required?"required":"",n.value=o.hasOwnProperty("value")?o.value:o.text,n.disabled=!!e.disabled&&"disabled",e.value&&(n.checked=e.value==n.value?"checked":""),a.appendChild(document.createElement("span")).innerHTML=o.text}),t},cot_form.prototype.checkboxFieldRender=function(e){var t=document.createElement(1==e.choices.length?"div":"fieldset");if(t.className=1==e.choices.length?"form-control form-control--div":"form-control",e.choices.length>1){var i=t.appendChild(document.createElement("legend"));i.className="sr-only",i.textContent="Select options for "+(e.title||e.id)}return $.each(e.choices,function(i,o){var a=t.appendChild(document.createElement("label"));a.className=e.orientation?e.orientation:"vertical",a.className+=" entryField checkboxLabel";var n=a.appendChild(document.createElement("input"));e.grid?n.name="row["+e.grid+"]."+e.id:(n.name=e.id,n.id=e.id+"_"+i),e.required&&n.setAttribute("aria-required","true"),n.type="checkbox",n.className=e.required?"required":"",n.value=o.hasOwnProperty("value")?o.value:o.text,n.disabled=!!e.disabled&&"disabled",o.selected&&(n.checked="checked"),a.appendChild(document.createElement("span")).innerHTML=o.text}),t},cot_form.prototype.dropdownFieldRender=function(e,t){var i=t.appendChild(document.createElement("div"));i.className="entryField dropdown-entry-field";var o=i.appendChild(document.createElement("select"));if(e.required&&o.setAttribute("aria-required","true"),e.grid){o.name="row["+e.grid+"]."+e.id;var a=$(o).closest(".grid-object").attr("id");$(o).attr("aria-labelledby",a+"_row_sr_label_"+e.grid+" "+e.gridlabel)}else o.name=e.id,o.id=e.id;return o.className="form-control",$.each(e.choices,function(t,i){var a=o.appendChild(document.createElement("option"));a.value=i.hasOwnProperty("value")?i.value:i.text,a.text=i.text,e.value&&(a.selected=e.value==a.value?"selected":"")}),o.disabled=!!e.disabled&&"disabled",i},cot_form.prototype.multiselectFieldRender=function(e,t){var i=t.appendChild(document.createElement("div"));i.className="entryField";var o=i.appendChild(document.createElement("select"));if(e.required&&o.setAttribute("aria-required","true"),e.grid){var a=$(o).closest(".grid-object").attr("id");o.name="row["+e.grid+"]."+e.id,$(o).attr("aria-labelledby",a+"_row_sr_label_"+e.grid+" "+e.gridlabel)}else o.name=e.id,o.id=e.id;return o.style.display="none",o.setAttribute("aria-hidden",!0),o.className="form-control multiselect "+e.id,o.multiple=e.multiple?"multiple":"",$.each(e.choices,function(e,t){var i=o.appendChild(document.createElement("option"));i.value=t.hasOwnProperty("value")?t.value:t.text,i.text=t.text}),o.disabled=!!e.disabled&&"disabled",i},cot_form.prototype.daterangepickerFieldRender=function(e,t){var i=t.appendChild(document.createElement("div"));i.className="entryField";var o=i.appendChild(document.createElement("input"));if(e.grid){var a=$(o).closest(".grid-object").attr("id");o.name="row["+e.grid+"]."+e.id,$(o).attr("aria-labelledby",a+"_row_sr_label_"+e.grid+" "+e.gridlabel)}else o.name=e.id,o.id=e.id;return o.type="text",o.value=e.value?e.value:"",o.className=e.required?"form-control required daterangevalidation":"form-control daterangevalidation",
e.required&&o.setAttribute("aria-required","true"),o.disabled=!!e.disabled&&"disabled",o.placeholder=e.placeholder||"",i},cot_form.prototype.datetimepickerFieldRender=function(e,t){var i=t.appendChild(document.createElement("div"));i.className="input-group date entryField datetimepicker "+e.id,i.setAttribute("data-refid",e.id);var o=i.appendChild(document.createElement("input"));if(o.type="text",e.required?(o.setAttribute("aria-required","true"),o.className="form-control required"):o.className="form-control",o.value=e.value||"",e.grid){var a=$(o).closest(".grid-object").attr("id");o.name="row["+e.grid+"]."+e.id,$(o).attr("aria-labelledby",a+"_row_sr_label_"+e.grid+" "+e.gridlabel)}else o.name=e.id,o.id=e.id;o.className="form-control";var n=i.appendChild(document.createElement("span"));return n.className="input-group-addon",n.setAttribute("aria-hidden",!0),n=n.appendChild(document.createElement("span")),n.className="glyphicon "+(e.glyphicon||"glyphicon-calendar"),o.disabled=!!e.disabled&&"disabled",o.placeholder=e.placeholder||"",i},cot_form.prototype.textareaFieldRender=function(e,t){var i=t.appendChild(document.createElement("div"));i.className="entryField";var o=i.appendChild(document.createElement("textarea"));if(e.htmlAttr&&$(o).attr(e.htmlAttr),e.grid){var a=$(o).closest(".grid-object").attr("id");o.name="row["+e.grid+"]."+e.id,$(o).attr("aria-labelledby",a+"_row_sr_label_"+e.grid+" "+e.gridlabel)}else o.name=e.id,o.id=e.id;return e.cols&&(o.cols=e.cols),e.rows&&(o.rows=e.rows),o.title=e.title,o.type="text",o.className+=e.required?"form-control required":"form-control",e.required&&o.setAttribute("aria-required","true"),o.placeholder=e.placeholder||"",o.value=e.value?e.value:"",o.disabled=!!e.disabled&&"disabled",i},cot_form.prototype.buttonFieldRender=function(e){var t=document.createElement("button");t.type="button",e.className&&!e.btnClass?t.className=e.className:t.className="btn btn-"+(e.btnClass||"success");var i=t.appendChild(document.createElement("span"));return i.className=e.glyphicon?"glyphicon "+e.glyphicon:"",i=t.appendChild(document.createElement("span")),i.textContent=e.title,t.disabled=!!e.disabled&&"disabled",$(t).on("click",e.onclick||function(){}),t},cot_form.prototype.dropzoneFieldRender=function(e){function t(){var t=n.dropzone.files;"function"==typeof e.options.valueMapFromFiles?t=t.map(e.options.valueMapFromFiles):"function"==typeof e.options.valueMap&&(t=t.map(e.options.valueMap));var i=$(o),a=t.length>0?JSON.stringify(t):"";a!=i.val()&&(i.val(a).trigger("change"),null!=i.closest("form").data("formValidation")&&i.closest("form").data("formValidation").revalidateField(i))}var i=document.createElement("div"),o=document.createElement("input");o.setAttribute("type","hidden"),o.setAttribute("data-fv-field",e.id),o.setAttribute("id",e.id),o.setAttribute("name",e.id),e.required&&(o.setAttribute("aria-required",!0),o.classList.add("required")),i.appendChild(o);var a=document.createElement("div");a.classList.add("dz-form-field"),i.appendChild(a),e.options.selector=a;var n=o.cotDropzone=new CotDropzone;e.validators=e.validators||{},e.validators.callback={callback:function(e,t,i){return n.dropzone.files.some(function(e){return e.status===Dropzone.ERROR})?{message:"File upload cannot contain any errors.",valid:!1}:{valid:!0}}},n._fillFromModel=function(t){if(e.bindTo){n.dropzone.removeAllFiles(!0);var i=n.initFiles=t.get(e.bindTo)||[];if("string"==typeof i)try{i=JSON.parse(i),Array.isArray(i)||(i=[])}catch(e){i=[]}Array.isArray(i)||(i=[i]);for(var o=0,a=i.length;o<a;o++)i[o].size=+i[o].size,isNaN(i.size)&&(i.size=-1);"function"==typeof e.options.valueMapToFiles&&(i=i.map(e.options.valueMapToFiles)),n.addInitialFiles.apply(n,_toConsumableArray(i))}},n._watchChanges=function(t){e.bindTo&&$(o).on("change",function(i){if(null!=t._model){var o=n.dropzone.files;if("function"==typeof e.options.valueMapFromFiles?o=o.map(e.options.valueMapFromFiles):"function"==typeof e.options.valueMap&&(o=o.map(e.options.valueMap)),!0!==e.excludeDeleted&&n.dropzone.deletedFiles){var a;"function"==typeof e.options.valueMapFromFiles?a=n.dropzone.deletedFiles.map(e.options.valueMapFromFiles):"function"==typeof e.options.valueMap&&(a=n.dropzone.deletedFiles.map(e.options.valueMap)),o=o.concat(a)}t._model.set(e.bindTo,o),t._model.trigger("change")}})},n.uploadAndCallback=function(e){var t=function(){e&&e({delete:n.dropzone.deletedFiles||[],keep:n.dropzone.files.filter(function(e){return e.status===Dropzone.SUCCESS&&null!=e.xhr})})};!function e(){var i=function t(){n.dropzone.off("queuecomplete",t),e()},o=n.dropzone.files.filter(function(e){return!0===e.accepted&&e.status===Dropzone.ADDED});o.length>0?(n.dropzone.on("queuecomplete",i),n.dropzone.enqueueFiles(o)):t()}()},this.success=function(t){return function(i){function o(){if((!1!==e.allowFormsubmitionWithUploadError||0===n.dropzone.files.filter(function(e){return e.status===Dropzone.ERROR}).length)&&null!=t)return t(i)}return i.preventDefault(),n.uploadAndCallback(o),!1}}(this.success);var r;if(null!=e.options.preset){var d=e.options.preset;"string"==typeof d&&(d=CotDropzone.presets[d]),null!=d&&null!=d.init&&(r=d.init)}if(null==r&&null!=CotDropzone.defaultOptions&&null!=CotDropzone.defaultOptions.preset){var l=CotDropzone.defaultOptions.preset;"string"==typeof l&&(l=CotDropzone.presets[l]),null!=l&&null!=l.init&&(r=l.init)}return e.options.init=CotDropzone.mergeFunctions(r,e.options.init,function(){this.on("addedfile",function(e){t()}),this.on("queuecomplete",function(){t()}),this.on("removedfile",function(e){t()}),this.on("error",function(e){t()}),this.options.onFieldChange=CotDropzone.mergeFunctions(this.options.onFieldChange,function(){t()})}),n.render(e.options),i},CotForm.prototype.render=function(e){if(this._isRendered)throw new Error("This form is already rendered");"string"==typeof e&&(e={target:e}),this.cotForm.render(e),this._isRendered=!0,this._useBinding&&(this._model&&this._fillFromModel(this._model),this._watchChanges())},CotForm.prototype.setModel=function(e){if(e&&"function"!=typeof e.get)throw new Error("Model must be a CotModel object");this._model=null,this._fillFromModel(e),this._model=e},CotForm.prototype._fillFromModel=function(e){function t(e,t,i){var o=i.get(t.bindTo);if(null!=o)switch(t.type){case"radio":case"checkbox":o=Array.isArray(o)?o:[o];var a=o.map(function(e,t,i){return'[value="'+e+'"]'}).join(",");e.filter(a).prop("checked",!0);break;case"phone":e.intlTelInput("setNumber",o);break;case"multiselect":o=Array.isArray(o)?o:[o],e.multiselect("select",o);break;case"datetimepicker":e.closest(".datetimepicker").data("DateTimePicker").date(o||"");break;case"daterangepicker":var n=e.data("daterangepicker");if(o.indexOf(n.locale.separator)>-1){var r=o.split(n.locale.separator);n.setStartDate(r[0]),n.setEndDate(r[1])}break;case"dropzone":var d=e.get(0);d&&d.cotDropzone&&d.cotDropzone._fillFromModel(i);break;default:e.val(o)}}var i=this;if(this._isRendered){!function o(a){for(var n=a.length,r=0;r<n;r++){"accordion"===a[r].type&&o(a[r].sections||[]);for(var d=a[r].rows||[],l=d.length,s=0;s<l;s++)if(d[s].fields)for(var c=d[s].fields,p=c.length,m=0;m<p;m++){var u=c[m];u.bindTo&&t($('[name="'+u.id+'"]'),u,e)}else if(d[s].grid&&d[s].grid.bindTo){var f=d[s].grid.bindTo;e.get(f)||e.set(f,new CotCollection);var h=CotForm._getModelInitValue(d[s].grid);if(!e.get(f).models){for(var v=e.get(f),g=v.length,b=0;b<g;b++)v[b]=$.extend({},h,v[b]);e.set(f,new CotCollection(v))}0==e.get(f).models.length&&e.get(f).push(new CotModel(h)),$("#"+d[s].grid.id+" [data-row-index]").not('[data-row-index="0"]').remove(),i.cotForm[d[s].grid.id+"-index"]=0;for(var _=e.get(f).models,y=_.length,C=0;C<y;C++){C>0&&$("#"+d[s].grid.id+" button.grid-add").trigger("click");for(var c=d[s].grid.fields,p=c.length,m=0;m<p;m++){var u=c[m];u.bindTo&&t($('[name="row['+C+"]."+u.id+'"]'),u,_[C])}}}else if(d[s].repeatControl&&d[s].repeatControl.bindTo){var f=d[s].repeatControl.bindTo;e.has(f)||e.set(f,new CotCollection);var h={};if(!e.get(f).models){var v=e.get(f);e.set(f,new CotCollection(v))}$("#"+d[s].repeatControl.id)[0].removeRows();for(var x=$(".repeatControl-sets .repeatControl-set .repeatControl-set-button .btn",$("#"+d[s].repeatControl.id)).length,_=e.get(f).models,y=_.length,C=0;C<y;C++){C+1>x&&$("#"+d[s].repeatControl.id)[0].addRow();for(var w=d[s].repeatControl.id,F=d[s].repeatControl.rows,E=F.length,k=0;k<E;k++)if(F[k].fields)for(var c=F[k].fields,p=c.length,m=0;m<p;m++){var u=c[m];u.bindTo&&t($('[name="'+w+"_"+C+"_"+u.id+'"]'),u,_[C])}else if(F[k].grid){var f=F[k].grid.bindTo,N=_[C];N.get(f)||N.set(f,new CotCollection);var h=CotForm._getModelInitValue(F[k].grid);if(!N.get(f).models){for(var v=N.get(f),g=v.length,b=0;b<g;b++)v[b]=$.extend({},h,v[b]);N.set(f,new CotCollection(v))}0==N.get(f).models.length&&N.get(f).push(new CotModel(h));var T=F[k].grid.id.replace("___idx___","_"+C+"_");$("#"+T+" [data-row-index]").not('[data-row-index="0"]').remove(),i.cotForm[T+"-index"]=0;for(var M=N.get(f).models,A=M.length,R=0;R<A;R++){R>0&&$("#"+T+" button.grid-add").trigger("click");for(var c=F[k].grid.fields,p=c.length,m=0;m<p;m++){var u=c[m];if(u.bindTo){var D=u.id.replace("___idx___","_"+C+"_"),I=$('[name="row['+R+"]."+D+'"]');t(I,u,M[R])}}}}}for(var C=y;C<x;C++)e.get(f).push(new CotModel)}}}(this._definition.sections||[])}},CotForm.prototype._setupField=function(e,t,i){if(t.bindTo){var o=this;switch(t.type){case"radio":e.on("click",function(e){if(o._model){var a=o._model;if(i)for(var n=i.split(/[\[\]\.]/),r=n.length,d=0;d<r;d++)null!=n[d]&&""!=n[d]&&(a instanceof Backbone.Model?a=a.get(n[d]):a instanceof Backbone.Collection&&(a=a.at(+n[d])));a.set(t.bindTo,$(e.currentTarget).val())}});break;case"checkbox":e.on("click",function(a){if(o._model){var n=[];$.each(e.filter(":checked"),function(){n.push($(this).val())});var r=o._model;if(i)for(var d=i.split(/[\[\]\.]/),l=d.length,s=0;s<l;s++)null!=d[s]&&""!=d[s]&&(r instanceof Backbone.Model?r=r.get(d[s]):r instanceof Backbone.Collection&&(r=r.at(+d[s])));r.set(t.bindTo,n)}});break;case"multiselect":e.on("change",function(a){if(o._model){var n=o._model;if(i)for(var r=i.split(/[\[\]\.]/),d=r.length,l=0;l<d;l++)null!=r[l]&&""!=r[l]&&(n instanceof Backbone.Model?n=n.get(r[l]):n instanceof Backbone.Collection&&(n=n.at(+r[l])));n.set(t.bindTo,e.val())}});break;case"datetimepicker":e.closest(".datetimepicker").on("dp.change",function(){if(o._model){var a=o._model;if(i)for(var n=i.split(/[\[\]\.]/),r=n.length,d=0;d<r;d++)null!=n[d]&&""!=n[d]&&(a instanceof Backbone.Model?a=a.get(n[d]):a instanceof Backbone.Collection&&(a=a.at(+n[d])));a.set(t.bindTo,e.val())}});break;case"dropzone":var a=e.get(0);a&&a.cotDropzone&&a.cotDropzone._watchChanges(o);break;default:e.on("change",function(a){if(o._model){var n=o._model;if(i)for(var r=i.split(/[\[\]\.]/),d=r.length,l=0;l<d;l++)null!=r[l]&&""!=r[l]&&(n instanceof Backbone.Model?n=n.get(r[l]):n instanceof Backbone.Collection&&(n=n.at(+r[l])));n.set(t.bindTo,e.val())}})}}},CotForm.prototype._watchChanges=function(){function e(e,i,o){t._setupField(e,i,o)}var t=this;if(this._isRendered){!function i(o){for(var a=o.length,n=0;n<a;n++){i(o[n].sections||[]);for(var r=o[n].rows||[],d=r.length,l=0;l<d;l++)if(r[l].fields)for(var s=r[l].fields,c=s.length,p=0;p<c;p++){var m=s[p];e($('[name="'+m.id+'"]'),m)}else if(r[l].grid){for(var s=r[l].grid.fields,c=s.length,p=0;p<c;p++){var m=s[p];$('[name$=".'+m.id+'"]').each(function(t,i){e($(this),m,r[l].grid.bindTo+"["+t+"]")})}var u=CotForm._getModelInitValue(r[l].grid),f=$("#"+r[l].grid.id+" button.grid-add").get(0);f.onclick=function(i,o){return function(a){i(a);var n=$("#"+o.id+" [data-row-index]:last");if($("button.grid-minus",n).off("click").on("click",function(e){var i=$("#"+o.id+" [data-row-index]"),a=$(this).closest("[data-row-index]"),n=i.index(a);if(t._model&&t._model.get(o.bindTo)){var r=t._model.get(o.bindTo);r&&r.models&&r.remove(r.models[n])}var d=$(this).closest("tr");$.each(d.find(".form-control"),function(e,i){var o=$(i),a="FIELDSET"===i.tagName.toUpperCase()?o.find("input").first().attr("name"):o.attr("name");$("#"+t.id).formValidation("removeField",a)});var l=d.prev().find("input,select,textarea").first();d.remove(),l.focus()}),t._model&&t._model.get(o.bindTo)){var r=t._model.get(o.bindTo);r&&r.push(new CotModel(u))}var d=+n.attr("data-row-index"),l="row["+d+"].";(o.fields||[]).forEach(function(t){e($('[name="'+l+t.id+'"]'),t,o.bindTo+"["+d+"]")})}}(f.onclick,r[l].grid)}else r[l].repeatControl}}(this._definition.sections||[])}},CotForm.prototype.getData=function(){var e={};return $("#"+this.cotForm.id).find("input[name], textarea[name], select[name]").each(function(t,i){var o=e,a=i.name,n=null;if(-1!==i.name.indexOf("row[")){var r=i.name.substring(i.name.indexOf("[")+1,i.name.indexOf("]"));if("template"!==r){var d=$(i).closest(".grid-object").attr("id");void 0===e[d]&&(e[d]=[]);var l=parseInt(r);void 0===e[d][l]&&(e[d][l]={}),o=e[d][l],a=i.name.split(".")[1]}else o=null}if(o)switch(i.tagName.toLowerCase()){case"input":switch(i.type){case"text":case"password":case"email":case"number":n=$(i).val();break;case"tel":n=$(i).intlTelInput("getNumber");break;case"checkbox":n=i.checked?$(i).val():null,void 0===o[a]?n=null===n?[]:[n]:null===n&&(o=null);break;case"radio":n=i.checked?$(i).val():null,null===o[a]?delete o[a]:void 0!==o[a]&&(o=null);break;default:o=null}break;case"textarea":n=$(i).val();break;case"select":if(i.multiple){var s=$(i).val();n=null===s?[]:s}else n=$(i).val();break;default:o=null}o&&(o.hasOwnProperty(a)?(o[a]=$.makeArray(o[a]),$.isArray(n)?o[a]=o[a].concat(n):o[a].push(n)):o[a]=n)}),e},CotForm._getModelInitValue=function(e){for(var t={},i=0,o=e.fields.length;i<o;i++){var a=e.fields[i];a.bindTo&&(("checkbox"===a.type||"multiselect"===a.type&&!0===a.multiple)&&(t[a.bindTo]=[]),"radio"===a.type?t[a.bindTo]=null:t[a.bindTo]="")}return t};