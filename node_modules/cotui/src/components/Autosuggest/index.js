import Vue from 'vue';
import Component from './Autosuggest'

/**
 * Initialize COTUI.Autosuggest
 * @property {string} options                
 * @property {string} options.target        - initialize components contained in the target.
 * @property {string} options.type          - '', addressLookup'
 * @property {object} callback               
 * @property {function} callback.onSubmit   - Extend onSubmit method
 * @property {function} callback.onSelected  - Extend onResults method
 * 
 * @return {object} _view
 * @listens results
 * @listens submit
 * @listens selected
 * 
*/

const Autosuggest = function (options={target:this.target, type:'', initCustomElements:false}, callback={onSelected:null, onSubmit:null, onSearch:null}){
    const el =  document.querySelector(options.target) || this.target;
    if(el === ''){ throw( new Error()); return;}

    const element = Vue.component( Component.name, Component.default || Component)
    const container = document.createElement('div');
    const $el = el.appendChild(container);

    const component = new Vue({
        render(createElement){
            options.onSearch = callback.onSearch;
            options.onSelected = callback.onSelected;
            options.onSubmit = callback.onSubmit;
            return createElement(element,{attrs: options})
        }
    })

    if(!options.initCustomElements){ component.$mount($el) }
    if(!window.vm) window.vm = new Vue({el})

    return{
        _view: component,
        results: (func)=>{ component.$children[0].$on('onResults', func) },
        submit: (func)=>{ component.$children[0].$on('onSubmit', func) },
        selected: (func)=>{ component.$children[0].$on('onSelect', func) }
    }
}

export default Autosuggest